<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<!-- Your interface name here-->
	<title></title>
	<!-- The description of this interfaces here -->
	<meta name="description" content="">
	<!-- Your CSS here -->
</head>
<body>
	<!-- Your markup here -->
	<p>Roster editor</p>
	<TEXTAREA rows="40" cols="80" id="roster" wrap="hard"></TEXTAREA><br>
	<button onClick="save();">Save roster</button>
				
	<!-- Scripts -->
	<script src="nutella_lib.js" type="text/javascript"></script>
	<!-- Your scripts here -->
				
	<script type="text/javascript">
	
	// Parse the query parameters
	var query_parameters = NUTELLA.parseURLParameters();

	// Get an instance of nutella. 
	var nutella = NUTELLA.init(query_parameters.broker, query_parameters.app_id, query_parameters.run_id, NUTELLA.parseComponentId());
	
	// (Optional) Set the resourceId
	// nutella.setResourceId('my_resource_id');

	nutella.net.request('roster',{},function(logins, from){ alert(logins[1].printNames); alert(logins[1].printNames[2]);
		document.getElementById('roster').value = '';	
		var s = '';
		for (var i=0; i<logins.length; i++) { 
			s += logins[i].type + "," + logins[i].owner; 
			for (var j=0; j<logins[i].printNames.length;j++) {
				s += ',' + logins[i].printNames[j]; 
			};
			s += '\n';
		}; 
		document.getElementById('roster').value = s; 
	})
	
	function save() {
		var r = []; 
		var t = document.getElementById('roster').value; 
		var s = [];
		s = t.split('\n');  
		for (var i=0; i<s.length; i++){
			if (s[i].length > 0) {
				var v = [];
				v = s[i].split(","); alert('v length: ' + v.length);
				if (v.length>0) { alert('got here  i = ' + i);
					var type = v[0];
					var owner = v[1];
					var printNames = [];
					for (var j=0; j<v.length-2; j++) {
						printNames[j] = v[j+2];
					};
					alert(printNames);
					r[i] = {type: type, owner: owner, printNames: printNames};
				}
			}	
		}; 
		nutella.net.publish('set_roster',r);
	};

	</script>
				
</body>
</html>