<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<!-- Your interface name here-->
	<title>Biotic Controls</title>
	<!-- The description of this interfaces here -->
	<meta name="description" content="Biotic Controls">
	<!-- Your CSS here -->
</head>
<body>


		<!-- Scripts -->
	<script src="nutella_lib.js" type="text/javascript"></script>
	<script> 
		window.document.write('<link rel="stylesheet" type="text/css" href="mystyle.css">'); 
		// Parse the query parameters
		var query_parameters = NUTELLA.parseURLParameters();
		var nutella = NUTELLA.init(query_parameters.broker, query_parameters.app_id, query_parameters.run_id, NUTELLA.parseComponentId());
	
		var DELAY=60 * 1000; //one minute between actions
		var inDelay = false;

		var ecosystem = query_parameters.INSTANCE;
		if (ecosystem === undefined) ecosystem = 0;

		var selected = -1;

		var s = screen.height/21;

		var claim;

		document.write('<table valign=top align=left><tr><td valign=top>');
		document.write('<a style="font-size:150%;color:#FFFF66;"> Species </a><br>');
		speciesSelector('species',-1,'block',1);
		document.write("</td>");
		document.write("<td width=50></td>");

		// Habitat selectors: where it lives


		document.write("<td valign=top>");
		document.write('<a style="font-size:150%;color:#FFFF66;"> Habitats </a><br>');
		document.write('<a style="font-size:125%;"> <i>Materials</i> </a> <br>');
		materialsSelector(.75);
		document.write('<a style="font-size:125%;"> <i>Temperatures</i> </a> <br>');
		temperatureSelector(.75);
//		document.write('</td><td align=left valign=top>');

		// Relationship selectors
		document.write("</td><td width=40></td>");
		document.write("<td>");

		document.write('<a style="font-size:150%;color:#FFFF66;"> Relationships with other species </a><br>');
		document.write('<a style="font-size:125%;"> <i>Eats</i><br></a>');
		speciesSelector('eats',selected,'horizontal',.75);
		document.write('<a style="font-size:125%;"> <i>Eaten by</i><br></a>');
		speciesSelector('eatenBy',selected,'horizontal',.75);
		document.write('<a style="font-size:125%;"> <i>Competes with</i><br></a>');
		speciesSelector('competesWith',selected,'horizontal',.75);
		document.write('</td></tr></table>');

		document.write('<br>');

		// end of first table (claims)

		document.write('<table width="965" bgcolor="#B8946A" valign=top align=left><tr><td width=50> </td><td align=left valign=top>');



		// second table depends on whether the support is in the form of an observation
		// or an experiment. Implementing Observations for now.




		document.write('<a style="font-size:150%;color:#FFFF66;"> Claim </a><br>');
		var pad = (i<10) ? '0' : '';
					// pad species name to match icon numbering scheme
					document.write('<img src="https://ltg.cs.uic.edu/WC/icons/species_' + pad + i + '.png" ');
"')



		document.write('<a style="font-size:150%;color:#FFFF66;"> Observations </a><br>');
		document.write('<textarea rows=8 cols=65 id="notes">We saw...</textarea>');
		document.write('<br>');



		// Reasoning  

		document.write('<a style="font-size:150%;color:#FFFF66;"> Reasoning </a><br>');
		document.write('<textarea rows=8 cols=65 id="notes">We think...</textarea><br>');
		document.write('</td><td align=left valign=top width="30">');


		document.write('<a style="font-size:150%;color:#FFFF66;" > Evidence </a><br>');
//		document.write('<div style="text-align:center;" >');

		document.write('<img id="evidence0" src="clickHere.jpg"><br>Figure 1<br>');
		document.write('<img id="evidence1" src="clickHere.jpg"><br>Figure 2<br>');
		document.write('<img id="evidence2" src="clickHere.jpg"><br>Figure 3<br>');
		document.write('</td><td align=left valign=top width="10%">');

		document.write('<a style="font-size:150%;color:#FFFF66;" > Commit </a><br>');

		document.write('<img id="refute" height=50 width=50 src="thumbsdown.png"><br>');
		document.write('<img id="support" height=50 width=50 src="thumbsup.png"><br>');
		document.write('<img id="defer" height=70 width=70 src="defer.png">');


		// document.write('<button onClick="withdraw(' + claim + ');" >Withdraw</button>');
		// document.write('<button onClick="save(' + claim + ');" >Save</button>');
		// document.write('<button vnClick="upload(' + claim + ');" >Share</button>');

		document.write('</td></tr></table>');

		deselectAll('eats');
		deselectAll('eatenBy');
		deselectAll('competesWith');
		document.write('<canvas onclick="alert(event.pageX)" id="canvasID" width=1000 height=800 style="pointer-events:none; position:absolute; top:0; left:0; z-index:1">');
		var context = document.getElementById('canvasID').getContext("2d");
		deselectAll('species');
		select('species0');




					// var pad = (i<10) ? '0' : '';
					// // pad species name to match icon numbering scheme
					// document.write('<img src="https://ltg.cs.uic.edu/WC/icons/species_' + pad + i + '.png" '
		
		function materialsSelector(size){

			document.write('<img src="wood.png" id="wood" onClick="select(this.id);" ');
			document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + '>&nbsp ');
			document.write('<img src="brick.png" id="brick" onClick="select(this.id);" ');
			document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + '>&nbsp ');
			document.write('<img src="aluminum.png" id="aluminum" onClick="select(this.id);" ');
			document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + '>&nbsp ');
			document.write('<img src="drywall.png" id="drywall" onClick="select(this.id);" ');
			document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + '> ');
			document.write('<br>');

		}

		function temperatureSelector(size){

			document.write('<img src="low.png" id="low" onClick="select(this.id);" ');
			document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + '>&nbsp ');
			document.write('<img src="medium.png" id="medium" onClick="select(this.id);" ');
			document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + '>&nbsp ');
			document.write('<img src="high.png" id="high" onClick="select(this.id);" ');
			document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + '> ');
			document.write('<br>');

		}


		function speciesSelector(idRoot,exception,direction,size) {
			document.write('<div id="' + idRoot + '" ">');
			if (direction == 'horizontal') document.write('&nbsp&nbsp'); //HTML kludge
			for (var i=0; i<11; i++) {
				if (i != exception) {
					var pad = (i<10) ? '0' : '';
					// pad species name to match icon numbering scheme
					document.write('<img src="https://ltg.cs.uic.edu/WC/icons/species_' + pad + i + '.png" ');
					// when you click on a species icon, it becomes selected
					document.write('onClick="select(this.id);" ');
					// set up the size
					document.write('width=' + (Math.round(s*size)) + ' height=' + (Math.round(s*size)) + ' ');
					// and give the item an id
					document.write('id="' + idRoot + i + '">');
					if (direction == 'horizontal') document.write('');
					if (direction == 'vertical') document.write('<br>');
					if (direction == 'block' && ((i+1) % 4 == 0)) document.write('<br>');
					document.getElementById('species' + i).style.opacity="0.35";
				}
			}
			document.write('</div>');		
			// if (direction == 'horizontal') document.write('');
		};

		// document.getElementById('img0').style.opacity="0.2";
		var selectedSpecies;

		function select(id){

			switch (id.substring(0,4)) {
				case 'spec': 	var s = document.getElementById(id);
								deselectAll('species');
								selected = Number(id.substring(7)); 
								document.getElementById(id).style.opacity = 1.0;
								nutella.net.request('get_observations',{group:query_parameters.INSTANCE,species:selected},function(message,from){
									document.getElementById('notes').value = message.notes;
									document.getElementById('wood').checked = message.wood;
									document.getElementById('brick').checked = message.brick;
									document.getElementById('aluminum').checked = message.aluminum;
									document.getElementById('drywall').checked = message.drywall;
									document.getElementById('low').checked = message.low;
									document.getElementById('medium').checked = message.medium;
									document.getElementById('high').checked = message.high;
									for (var i=0; i<11; i++) {
										document.getElementById('eats' + i).style.opacity = message.eats[i].opacity;
									}
									for (var i=0; i<11; i++) {
										document.getElementById('eatenBy' + i).style.opacity = message.eatenBy[i].opacity;
									}
									for (var i=0; i<11; i++) {
										document.getElementById('competesWith' + i).style.opacity = message.competesWith[i].opacity;
									}
								});								
								break;
				case 'wood':
				case 'bric':
				case 'alum':
				case 'dryw':    
								var newX = document.getElementById('wood').parentElement.offsetLeft + 
												document.getElementById(id).offsetLeft;
							 	var newY = document.getElementById('wood').parentElement.offsetTop + 
												document.getElementById(id).offsetTop;
								drawEllipse(newX+163,newY+40,60,60);
								break;
				case 'low':      
				case 'medi':
				case 'high':    var newX = document.getElementById('low').parentElement.offsetLeft + 
												document.getElementById(id).offsetLeft;
							 	var newY = document.getElementById('low').parentElement.offsetTop + 
												document.getElementById(id).offsetTop;
								drawEllipse(newX+163,newY+40,60,60);
								break;
				case 'eate':
				case 'comp': 	
				case 'eats': 	var newX = document.getElementById('eats').parentElement.offsetLeft + 
												document.getElementById(id).offsetLeft;
							 	var newY = document.getElementById('eats').parentElement.offsetTop + 
												document.getElementById(id).offsetTop;
								drawEllipse(newX+163,newY+40,60,60);



			}
		}

		function drawEllipse(centerX, centerY, width, height) {
		  context.lineWidth=4;
		  context.beginPath();
		  
		  context.moveTo(centerX, centerY - height/2); // A1
		  
		  context.bezierCurveTo(
		    centerX + width/2, centerY - height/2, // C1
		    centerX + width/2, centerY + height/2, // C2
		    centerX, centerY + height/2); // A2

		  context.bezierCurveTo(
		    centerX - width/2, centerY + height/2, // C3
		    centerX - width/2, centerY - height/2, // C4
		    centerX, centerY - height/2); // A1
		 
			context.strokeStyle = "red";
//			context.stroke();
		  context.closePath();	
		  context.stroke();
		}


		// function select(species){
		// 	if (!inDelay) {
		// 		selected = species;
		// 		deselect();
		// 		document.getElementById('species' + species).style.opacity="1.0";
		// 		// hard-wired dependency
		// 		if (species==4 || species==5 || species==9 || species==10) {
		// 			enableVegieControls(); 
		// 			disableAnimalControls();
		// 		} else {
		// 			enableAnimalControls(); 
		// 			disableVegieControls();
		// 		}
		// 	}
		// }

		function selectAll(idRoot) {
			for (i=0; i<11; i++) document.getElementById(idRoot + i).style.opacity="1.0";						
		}

		function deselectAll(idRoot) {
			for (i=0; i<11; i++) document.getElementById(idRoot + i).style.opacity="0.35";			
		}

		function enableVegieControls() {
			document.getElementById('seed').disabled=false;
			document.getElementById('herbicide').disabled=false;
		}

		function disableVegieControls() {
			document.getElementById('seed').disabled=true;
			document.getElementById('herbicide').disabled=true;
		}

		function enableAnimalControls() {
			document.getElementById('colonizer').disabled=false;
			document.getElementById('trap').disabled=false;
		}

		function disableAnimalControls() {
			document.getElementById('colonizer').disabled=true;
			document.getElementById('trap').disabled=true;
		}

		function seed () {
			if (!inDelay) {
				nutella.net.publish('seed',{ecosystem:ecosystem,species:selected});
				document.getElementById('herbicide').disabled=true;
				block();
			} else alert('In Delay. Click ignored.');
		}

		function herbicide () {
			if (!inDelay) {
				nutella.net.publish('herbicide',{ecosystem:ecosystem,species:selected});
				document.getElementById('seed').disabled=true;
				block();
			} else alert('In Delay. Click ignored.');
		}

		function colonize () {
			if (!inDelay) {
				nutella.net.publish('colonize',{ecosystem:ecosystem,species:selected});
				document.getElementById('trap').disabled=true;
				block();
			} else alert('In Delay. Click ignored.');
		}

		function trap () {
			if (!inDelay) {
				nutella.net.publish('trap',{ecosystem:ecosystem,species:selected});
				document.getElementById('colonize').disabled=true;
				block();
			} else alert('In Delay. Click ignored.');
		}

		function block () {
			inDelay = true;
			setTimeout(unblock, DELAY);

		}

		function unblock () {
			disableVegieControls();
			disableAnimalControls();
			deselect();
			inDelay=false;
		}
// 	}

	// Your code that uses the nutella instance here
	
	
	// EXAMPLES
	// You can do stuff like:
	
	// // 1. Subscribing to a channel
	// nutella.net.subscribe('demo_channel', function(message, from_component_id, from_resource_id) {
	// 	// Your code to handle messages received on this here
	// });
	
	// // 2. Subscribe to a wildcard channel (a.k.a. more than one channel at the same time,
	// // in the example below we'll receive messages on demo_channel/a, demo_channel/a/b, demo_channel/c, etc.)
	// nutella.net.subscribe('demo_channel/#', function(message, channel, from_component_id, from_resource_id) {
	// 	// Your code to handle messages received by this channel here
	// });
	
	// // 3. Publish a message to a channel
	// nutella.net.publish('demo_channel', 'demo_message');
	
	// // 3a The cool thing is that the message can be any Javascript variable or object
	// nutella.net.publish('demo_channel', {a: 'proper', key: 'value'});
	
	// // 4. Make requests on a certain channel...
	// nutella.net.request('demo_channel', 'my_request', function(response) {
	// 	// Your code to handle the response here
	// });
	
	// // 4a ... and, guess what, we can send anything in a request, like in publish!
	// // Requests can even be empty, kind of like a GET
	// nutella.net.request('demo_channel', function(response) {
	// 	// Your code to handle the response here
	// });
	
	// // 5. Handle requests from other components
	// nutella.net.handle_requests('my_channel', function(request, component_id, resource_id) {
	// 	/// Your code to handle each request here
	// 	// Anything this function returns (string, integer, object,...) is going to be sent as the response
	// 	var response = 'this is my response';
	// 	// Or...
	// 	// var response = {};
	// 	// var response = 12345;
	// 	// var response = {a: 'proper', key: 'value'};
	// 	return response;
	// });
	
	// // 6. Access the variables that uniquely identify this instance of this component
	// nutella.runId;
	// nutella.componentId;
	// nutella.resourceId;
	
	// // 7. Do you need an extra instance of nutella (to work with React components for instance)? Not a problem...
	// // var nutella2 = NUTELLA.init(query_parameters.run_id, query_parameters.broker, 'your_interface_name');
	
	// // HAVE FUN WITH nutella!
	
	</script>
				
</body>
</html>


