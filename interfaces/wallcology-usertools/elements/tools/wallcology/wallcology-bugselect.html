<!DOCTYPE html>
<html>
<head>
  <!-- 	<link href="../bower_components/iron-input/iron-input.html" rel="import"> -->
  <!-- 	<link href="../bower_components/paper-button/paper-button.html" rel="import"> -->
</head>

<dom-module id="wallcology-bugselect">
  <style>

    :host {
      --paper-input-container-color: white;
      --paper-input-container-focus-color: white;
      --paper-input-container-input-color: white;
    }

  </style>
  <template>
    <iron-ajax id="habitatAjax"
               contentType="application/json"
               url="http://beta.json-generator.com/api/json/get/NkcQCTno"
               params=""
               handle-as="json"
               on-response="handleHabitatResponse" loading="{{loading}}" method="GET" auto verbose>
    </iron-ajax>
<div>

      <template is="dom-repeat" items="{{currentHabitat.bugs}}">
        <span>{{item}}</span>
      </template>

</div>
    </template>
</dom-module>

<script>
  // element registration
  Polymer({
    is: 'wallcology-bugselect',

    // add properties and methods on the element's prototype
    properties: {
      // declare properties for the element's public API
      habitats: {
        type: Array,
        notify: true,
        value: []
      },
      selectedBugs: {
        type: Array,
        notify: true,
        value: []
      },
      currentHabitat: {
        type: Object,
        notify: true,
        value: {},
        observer: 'currentHabitatChanged'
      },
    },
    currentHabitatChanged: function (newValue, oldValue) {
      console.log('H: NEW' + newValue + 'old' + oldValue);
      if( this.habitats != null ) {
        console.log('current habitat ' + this.currentHabitat.name);
        console.log('current bugs ' + this.currentHabitat.bugs);
      }
    },
    handleHabitatResponse: function (e) {
      console.log(this.$.habitatAjax.lastResponse);
      this.habitats = this.$.habitatAjax.lastResponse;
      this.currentHabitat = this.habitats[0];
      for (var i = 0; i < this.habitats.length; i++) {
        console.log(this.habitats[i]);
      }
    },
    toCompleteHeading: function(userString){
      if( userString != null ) {
        return userString.toUpperCase() + ' : BZEDS-1';
      }
      return null;
    },
    toUpperCase: function(someString) {
      if( someString != null )
        return someString.toUpperCase();

      return null;
    },
    ready: function () {
      this.currentHabitat = {};
    },
    attributeChanged: function (name, type) {
      console.log(this.localName + '#' + this.id + ' attribute ' + name +
        ' was changed to ' + this.getAttribute(name) + type);
    }
  });
</script>
